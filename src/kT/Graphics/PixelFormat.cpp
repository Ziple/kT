#include <kT/Graphics/PixelFormat.hpp>

namespace kT
{
    // RGBA Formats.
    PixelComponentFormatDescriptor rgba32floatDesc[] = {
            { "R", PixelFormat::Float32Component },
            { "G", PixelFormat::Float32Component },
            { "B", PixelFormat::Float32Component },
            { "A", PixelFormat::Float32Component }
        };

    PixelComponentFormatDescriptor rgba32intDesc[] = {
            { "R", PixelFormat::IntComponent },
            { "G", PixelFormat::IntComponent },
            { "B", PixelFormat::IntComponent },
            { "A", PixelFormat::IntComponent }
        };

    PixelComponentFormatDescriptor rgba32uintDesc[] = {
            { "R", PixelFormat::UnsignedComponent },
            { "G", PixelFormat::UnsignedComponent },
            { "B", PixelFormat::UnsignedComponent },
            { "A", PixelFormat::UnsignedComponent }
        };

    PixelComponentFormatDescriptor rgba16floatDesc[] = {
            { "R", PixelFormat::Float16Component },
            { "G", PixelFormat::Float16Component },
            { "B", PixelFormat::Float16Component },
            { "A", PixelFormat::Float16Component }
        };

    PixelComponentFormatDescriptor rgba16intDesc[] = {
            { "R", PixelFormat::ShortComponent },
            { "G", PixelFormat::ShortComponent },
            { "B", PixelFormat::ShortComponent },
            { "A", PixelFormat::ShortComponent }
        };

    PixelComponentFormatDescriptor rgba16uintDesc[] = {
            { "R", PixelFormat::UnsignedShortComponent },
            { "G", PixelFormat::UnsignedShortComponent },
            { "B", PixelFormat::UnsignedShortComponent },
            { "A", PixelFormat::UnsignedShortComponent }
        };

    PixelComponentFormatDescriptor rgba16unormDesc[] = {
            { "R", PixelFormat::UnsignedShortComponent },
            { "G", PixelFormat::UnsignedShortComponent },
            { "B", PixelFormat::UnsignedShortComponent },
            { "A", PixelFormat::UnsignedShortComponent }
        };

    PixelComponentFormatDescriptor rgba8intDesc[] = {
            { "R", PixelFormat::ByteComponent },
            { "G", PixelFormat::ByteComponent },
            { "B", PixelFormat::ByteComponent },
            { "A", PixelFormat::ByteComponent }
        };

    PixelComponentFormatDescriptor rgba8uintDesc[] = {
            { "R", PixelFormat::UnsignedByteComponent },
            { "G", PixelFormat::UnsignedByteComponent },
            { "B", PixelFormat::UnsignedByteComponent },
            { "A", PixelFormat::UnsignedByteComponent }
        };

    PixelComponentFormatDescriptor rgba8unormDesc[] = {
            { "R", PixelFormat::UnsignedByteComponent },
            { "G", PixelFormat::UnsignedByteComponent },
            { "B", PixelFormat::UnsignedByteComponent },
            { "A", PixelFormat::UnsignedByteComponent }
        };

    // RGB format
        PixelComponentFormatDescriptor rgb32floatDesc[] = {
            { "R", PixelFormat::Float32Component },
            { "G", PixelFormat::Float32Component },
            { "B", PixelFormat::Float32Component }
        };

    PixelComponentFormatDescriptor rgb32intDesc[] = {
            { "R", PixelFormat::IntComponent },
            { "G", PixelFormat::IntComponent },
            { "B", PixelFormat::IntComponent }
        };

    PixelComponentFormatDescriptor rgb32uintDesc[] = {
            { "R", PixelFormat::UnsignedComponent },
            { "G", PixelFormat::UnsignedComponent },
            { "B", PixelFormat::UnsignedComponent }
        };

    // RG Formats
        PixelComponentFormatDescriptor rg32floatDesc[] = {
            { "R", PixelFormat::Float32Component },
            { "G", PixelFormat::Float32Component }
        };

    PixelComponentFormatDescriptor rg32intDesc[] = {
            { "R", PixelFormat::IntComponent },
            { "G", PixelFormat::IntComponent }
        };

    PixelComponentFormatDescriptor rg32uintDesc[] = {
            { "R", PixelFormat::UnsignedComponent },
            { "G", PixelFormat::UnsignedComponent }
        };

    PixelComponentFormatDescriptor rg16floatDesc[] = {
            { "R", PixelFormat::Float16Component },
            { "G", PixelFormat::Float16Component }
        };

    PixelComponentFormatDescriptor rg16intDesc[] = {
            { "R", PixelFormat::ShortComponent },
            { "G", PixelFormat::ShortComponent }
        };

    PixelComponentFormatDescriptor rg16uintDesc[] = {
            { "R", PixelFormat::UnsignedShortComponent },
            { "G", PixelFormat::UnsignedShortComponent }
        };

    PixelComponentFormatDescriptor rg16unormDesc[] = {
            { "R", PixelFormat::UnsignedShortComponent },
            { "G", PixelFormat::UnsignedShortComponent }
        };

    PixelComponentFormatDescriptor rg8intDesc[] = {
            { "R", PixelFormat::ByteComponent },
            { "G", PixelFormat::ByteComponent }
        };

    PixelComponentFormatDescriptor rg8uintDesc[] = {
            { "R", PixelFormat::UnsignedByteComponent },
            { "G", PixelFormat::UnsignedByteComponent }
        };

    PixelComponentFormatDescriptor rg8unormDesc[] = {
            { "R", PixelFormat::UnsignedByteComponent },
            { "G", PixelFormat::UnsignedByteComponent }
        };
    // R formats
        PixelComponentFormatDescriptor r32floatDesc[] = {
            { "R", PixelFormat::Float32Component }
        };

    PixelComponentFormatDescriptor r32intDesc[] = {
            { "R", PixelFormat::IntComponent }
        };

    PixelComponentFormatDescriptor r32uintDesc[] = {
            { "R", PixelFormat::UnsignedComponent }
        };

    PixelComponentFormatDescriptor r16floatDesc[] = {
            { "R", PixelFormat::Float16Component }
        };

    PixelComponentFormatDescriptor r16intDesc[] = {
            { "R", PixelFormat::ShortComponent }
        };

    PixelComponentFormatDescriptor r16uintDesc[] = {
            { "R", PixelFormat::UnsignedShortComponent }
        };

    PixelComponentFormatDescriptor r16unormDesc[] = {
            { "R", PixelFormat::UnsignedShortComponent }
        };

    PixelComponentFormatDescriptor r8intDesc[] = {
            { "R", PixelFormat::ByteComponent }
        };

    PixelComponentFormatDescriptor r8uintDesc[] = {
            { "R", PixelFormat::UnsignedByteComponent }
        };

    PixelComponentFormatDescriptor r8unormDesc[] = {
            { "R", PixelFormat::UnsignedByteComponent }
        };

    PixelComponentFormatDescriptor d24Desc[] = {
            { "D", PixelFormat::Depth24Component }
        };

    PixelComponentFormatDescriptor d24s8Desc[] = {
            { "D", PixelFormat::Depth24Component },
            { "S", PixelFormat::UnsignedByteComponent }
        };

    PixelFormatDescriptor PixelUtility::ourDescriptors[ PixelFormat::COUNT ] = 
    {
        {
            PixelFormat::Unknown,
            0,
            0,
            0
        },
        {
            PixelFormat::RGBA32_FLOAT,
            PixelFormat::Alpha | PixelFormat::Float,
            4,
            rgba32floatDesc
        },
        {
            PixelFormat::RGBA32_INT,
            PixelFormat::Alpha,
            4,
            rgba32intDesc
        },
        {
            PixelFormat::RGBA32_UINT,
            PixelFormat::Alpha,
            4,
            rgba32uintDesc
        },
        {
            PixelFormat::RGBA16_FLOAT,
            PixelFormat::Alpha | PixelFormat::Float,
            4,
            rgba16floatDesc
        },
        {
            PixelFormat::RGBA16_INT,
            PixelFormat::Alpha,
            4,
            rgba16intDesc
        },
        {
            PixelFormat::RGBA16_UINT,
            PixelFormat::Alpha,
            4,
            rgba16uintDesc
        },
        {
            PixelFormat::RGBA16_UNORM,
            PixelFormat::Alpha | PixelFormat::Norm,
            4,
            rgba16unormDesc
        },
        {
            PixelFormat::RGBA8_INT,
            PixelFormat::Alpha,
            4,
            rgba8intDesc
        },
        {
            PixelFormat::RGBA8_UINT,
            PixelFormat::Alpha,
            4,
            rgba8uintDesc
        },
        {
            PixelFormat::RGBA8_UNORM,
            PixelFormat::Alpha | PixelFormat::Norm,
            4,
            rgba8unormDesc
        },
        {
            PixelFormat::RGB32_FLOAT,
            PixelFormat::Float,
            3,
            rgb32floatDesc
        },
        {
            PixelFormat::RGB32_INT,
            0,
            3,
            rgb32intDesc
        },
        {
            PixelFormat::RGB32_UINT,
            0,
            3,
            rgb32uintDesc
        },
        {
            PixelFormat::RG32_FLOAT,
            PixelFormat::Float,
            2,
            rg32floatDesc
        },
        {
            PixelFormat::RG32_INT,
            0,
            2,
            rg32intDesc
        },
        {
            PixelFormat::RG32_UINT,
            0,
            2,
            rg32uintDesc
        },
        {
            PixelFormat::RG16_FLOAT,
            PixelFormat::Float,
            2,
            rg16floatDesc
        },
        {
            PixelFormat::RG16_INT,
            0,
            2,
            rg16intDesc
        },
        {
            PixelFormat::RG16_UINT,
            0,
            2,
            rg16uintDesc
        },
        {
            PixelFormat::RG16_UNORM,
            PixelFormat::Norm,
            2,
            rg16unormDesc
        },
        {
            PixelFormat::RG8_INT,
            0,
            2,
            rg8intDesc
        },
        {
            PixelFormat::RG8_UINT,
            0,
            2,
            rg8uintDesc
        },
        {
            PixelFormat::RG8_UNORM,
            PixelFormat::Norm,
            2,
            rg8unormDesc
        },
        {
            PixelFormat::R32_FLOAT,
            PixelFormat::Float,
            1,
            r32floatDesc
        },
        {
            PixelFormat::R32_INT,
            0,
            1,
            r32intDesc
        },
        {
            PixelFormat::R32_UINT,
            0,
            1,
            r32uintDesc
        },
        {
            PixelFormat::R16_FLOAT,
            PixelFormat::Float,
            1,
            r16floatDesc
        },
        {
            PixelFormat::R16_INT,
            0,
            1,
            r16intDesc
        },
        {
            PixelFormat::R16_UINT,
            0,
            1,
            r16uintDesc
        },
        {
            PixelFormat::R16_UNORM,
            PixelFormat::Norm,
            1,
            r16unormDesc
        },
        {
            PixelFormat::R8_INT,
            0,
            1,
            r8intDesc
        },
        {
            PixelFormat::R8_UINT,
            0,
            1,
            r8uintDesc
        },
        {
            PixelFormat::R8_UNORM,
            PixelFormat::Norm,
            1,
            r8unormDesc
        },
        // depth-stencil texture formats
        {
            PixelFormat::DEPTH,
            PixelFormat::Depth,
            1,
            d24Desc
        },
        {
            PixelFormat::DEPTH_STENCIL,
            PixelFormat::DepthStencil,
            2,
            d24s8Desc
        },
    };

    size_t KT_API PixelComponentFormatDescriptor::GetComponentSize() const
    {
        static size_t componentSizeLookupTable[] = { 1, 1, 2, 2, 4, 4, 2, 4, 3 };
        return componentSizeLookupTable[ static_cast<size_t>(Type) ];
    }

    size_t KT_API PixelFormatDescriptor::GetSize() const
    {
        size_t size = 0;
        for( size_t i = 0; i < ComponentsNumber; i++ )
            size += ComponentsDescriptors[i].GetComponentSize();
        return size;
    }

    const PixelFormatDescriptor& PixelUtility::GetPixelFormatDescriptor( PixelFormat::Format format )
    {
        return ourDescriptors[ static_cast<size_t>(format) ];
    }
}
